task :default => [:build]

desc "Builds the solution using Mono"
task :build do
  sh "api/.paket/paket.exe install"
  sh "xbuild /verbosity:quiet"
end

desc "Run tests for all modules"
task :test do
  Rake::Task['test'].invoke
end

task :docker do
  Rake::Task['docker:running'].invoke
end

namespace :docker do

  groups = [:databases, :monitoring, :trackwane, :infrastructure]

  task :clean do
    sh "docker rm -v $(docker ps -a -q -f status=exited)"
    sh "docker rmi $(docker images -f ""dangling=true"" -q)"
  end

  namespace :up do
    groups.each do |group|
      desc "Starts all " + group.to_s + " containers"
      task group do
        sh "docker-compose --file ./docker/" + group.to_s + ".yml up -d"
      end
    end
  end

  namespace :down do
    groups.each do |group|
      desc "Stops all " + group.to_s + " containers"
      task group do
        sh "docker-compose --file ./docker/" + group.to_s + ".yml down"
      end
    end
  end

end
